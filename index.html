<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ArAi Mobile App</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }
        
        body, html, button, input, textarea, div, p, h1, h2, h3, span, li {
            font-family: 'Inter', sans-serif !important;
            font-weight: 500 !important;
        }

        body, html {
            background-color: white;
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        .safe-top { padding-top: var(--safe-top); }
        .safe-bottom { padding-bottom: var(--safe-bottom); }

        .message-user { background-color: #2563eb; color: white; border-bottom-right-radius: 4px; }
        .message-ai { background-color: #f1f5f9; color: #1e293b; border-bottom-left-radius: 4px; }
        .typing-indicator { font-style: italic; opacity: 0.7; font-size: 0.9rem; }
        .hidden { display: none !important; }

        .logo-header { height: 65px; width: auto; display: block; }

        #app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            background: white;
            position: relative;
            z-index: 1;
            transition: filter 0.3s ease;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div id="app-container">
        <header class="safe-top bg-white px-2 py-2 flex items-center justify-between shrink-0 z-10 shadow-sm border-b border-slate-50">
            <img src="https://filedn.eu/liPnBWWQgeQVeGgdPoPnl8S/arai/arailogonew.png" alt="ArAi Logo" class="logo-header">
            <button onclick="openSettings()" class="p-2 active:scale-90 transition-transform mr-1">
                <img src="https://filedn.eu/liPnBWWQgeQVeGgdPoPnl8S/arai/settings.png" alt="Ayarlar" class="w-8 h-8 object-contain">
            </button>
        </header>

        <main id="welcome-screen" class="flex-1 flex flex-col items-center justify-center px-8 text-center">
            <h1 class="text-4xl font-bold mb-4">
                <span class="text-slate-900">Ar</span><span class="text-blue-600">Ai</span><span class="text-slate-900">'a Hoşgeldin</span>
            </h1>
            <p class="text-slate-500 text-xl mb-12">Hangi konudan bahsetmek istersin?</p>
            <button onclick="startChat()" class="w-full max-w-xs bg-blue-600 text-white py-5 rounded-2xl shadow-lg active:scale-95 transition-all text-xl mb-8">
                Sohbete Başla
            </button>
            <button onclick="openPrivacy()" class="text-slate-400 text-xs border-b border-slate-300 pb-0.5 hover:text-slate-600 transition-colors mt-4">
                Aydınlatma Metni
            </button>
        </main>

        <main id="chat-screen" class="flex-1 flex flex-col hidden overflow-hidden">
            <div id="chat-messages" class="flex-1 overflow-y-auto px-4 py-4 space-y-4 flex flex-col">
                <div class="flex justify-start">
                    <div class="message-ai max-w-[85%] p-3 px-4 rounded-2xl text-base">
                        Merhaba! Ben ArAi. Hangi konudan bahsetmek istersin?
                    </div>
                </div>
            </div>
            <footer id="chat-footer" class="bg-white px-3 py-3 border-t border-slate-100 shrink-0">
                <div class="flex items-center gap-2">
                    <input type="text" id="user-input" placeholder="Mesajınızı yazın..." autocomplete="off"
                           class="flex-1 bg-slate-50 border border-slate-200 rounded-full px-5 py-3 outline-none focus:border-blue-500 transition-colors text-base">
                    <button onclick="sendMessage()" class="w-12 h-12 flex items-center justify-center rounded-full active:scale-90 transition-all shrink-0">
                        <img src="https://filedn.eu/liPnBWWQgeQVeGgdPoPnl8S/arai/sendbutton.png" alt="Send" class="w-full h-full object-contain">
                    </button>
                </div>
                <div class="text-center mt-2">
                    <p class="text-[11px] text-slate-400 select-none">ArAi Beta, hata yapabilir.</p>
                </div>
                <div class="safe-bottom"></div>
            </footer>
        </main>
    </div>

    <div id="loading-overlay" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="loader"></div>
    </div>

    <div id="settings-panel" class="fixed inset-0 z-50 bg-white transform translate-x-full transition-transform duration-300 ease-in-out flex flex-col shadow-2xl">
        <header class="safe-top bg-white px-4 py-4 flex items-center border-b border-slate-100 shrink-0">
            <button onclick="closeSettings()" class="p-2 -ml-2 mr-2 active:scale-90 transition-transform text-slate-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
            <h2 class="text-xl font-bold text-slate-900">Ayarlar</h2>
        </header>
        <div class="flex-1 p-6">
            <button onclick="checkUpdates()" id="update-btn" class="w-full flex items-center justify-between p-4 bg-slate-50 rounded-2xl">
                <span class="text-slate-700 text-sm">Güncellemeleri Denetle</span>
                <span id="update-status" class="hidden text-[10px] font-bold text-blue-600 bg-blue-100 px-2 py-0.5 rounded-full">GÜNCEL</span>
            </button>
        </div>
    </div>

    <div id="privacy-panel" class="fixed inset-0 z-50 bg-white transform translate-y-full transition-transform duration-300 ease-in-out flex flex-col shadow-2xl">
        <header class="safe-top bg-white px-4 py-4 flex items-center justify-between border-b border-slate-100 shrink-0">
            <h2 class="text-xl font-bold text-slate-900 ml-2">Aydınlatma Metni</h2>
            <button onclick="closePrivacy()" class="p-2 active:scale-90 transition-transform text-slate-600 bg-slate-100 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </header>
        <div class="flex-1 p-6 overflow-y-auto text-sm text-slate-600 space-y-4">
            <p>ArAi, kullanıcı gizliliğini en üst düzeyde tutar. Veriler cihazınızda tutulur.</p>
        </div>
    </div>

    <script>
        const BACKEND_URL = "https://chat-po6bup4n5q-uc-419259839186.us-central1.run.app"; 
        let chatHistory = [];
        const MAX_HISTORY = 10;

        const AI_SYSTEM_INSTRUCTION = `Senin adın ArAi. Türkçe konuşan zeki bir asistansın. Kısa ve öz cevap ver. "Siz" diye hitap et. Kimlik sorularına "Ben ArAi tarafından geliştirildim" de. Gizlilik sorularına "Aydınlatma Metnini gözden geçiriniz" de. Tarih/saat sormadıkça söyleme.`;

        function openSettings() { document.getElementById('settings-panel').classList.remove('translate-x-full'); }
        function closeSettings() { document.getElementById('settings-panel').classList.add('translate-x-full'); }
        function openPrivacy() { document.getElementById('privacy-panel').classList.remove('translate-y-full'); }
        function closePrivacy() { document.getElementById('privacy-panel').classList.add('translate-y-full'); }

        function startChat() {
            document.getElementById('loading-overlay').classList.remove('hidden');
            document.getElementById('app-container').style.filter = "blur(5px)";
            setTimeout(() => {
                document.getElementById('loading-overlay').classList.add('hidden');
                document.getElementById('app-container').style.filter = "none";
                document.getElementById('welcome-screen').classList.add('hidden');
                document.getElementById('chat-screen').classList.remove('hidden');
            }, 2500);
        }

        function appendMessage(text, sender, id = null) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            msgDiv.innerHTML = `<div ${id ? `id="${id}"` : ''} class="max-w-[85%] p-3 px-4 rounded-2xl text-base ${sender === 'user' ? 'message-user' : 'message-ai'}">${text}</div>`;
            document.getElementById('chat-messages').appendChild(msgDiv);
            document.getElementById('chat-messages').scrollTo({ top: document.getElementById('chat-messages').scrollHeight, behavior: 'smooth' });
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if (!text) return;

            appendMessage(text, 'user');
            input.value = '';
            chatHistory.push({ role: 'user', content: text });

            const tId = 't-' + Date.now();
            appendMessage("Düşünüyorum...", 'ai', tId);
            const tEl = document.getElementById(tId);
            tEl.classList.add('typing-indicator');

            const now = new Date();
            const timeCtx = `[Bugün ${now.toLocaleDateString('tr-TR')}, Saat ${now.toLocaleTimeString('tr-TR')}].`;
            let historyStr = chatHistory.map(m => `${m.role === 'user' ? 'Kullanıcı' : 'ArAi'}: ${m.content}`).join('\n');

            try {
                const res = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: `${AI_SYSTEM_INSTRUCTION}\n${timeCtx}\nGeçmiş:\n${historyStr}\nSon Mesaj: ${text}` })
                });
                const data = await res.json();
                tEl.innerText = data.reply || "Hata oluştu.";
                tEl.classList.remove('typing-indicator');
                chatHistory.push({ role: 'ai', content: data.reply });
                if (chatHistory.length > MAX_HISTORY) chatHistory.shift();
            } catch (e) {
                tEl.innerText = "Bağlantı hatası.";
            }
        }

        document.getElementById('user-input').addEventListener('keypress', e => { if(e.key === 'Enter') sendMessage(); });
    </script>
</body>
</html>
